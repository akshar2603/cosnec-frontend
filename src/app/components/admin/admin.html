<!-- HEADER / NAV -->
<header class="header">
  <div class="logo">ðŸŒ¿ COSNEC</div>
  <nav class="nav">
    <a *ngIf="!loggedIn" routerLink="/register">Login</a>

    <div class="profile-wrapper" *ngIf="loggedIn" [class.open]="profileOpen">
      <button class="profile-icon" (click)="profileOpen = !profileOpen">ðŸ‘¤</button>
      <div class="dropdown-menu" *ngIf="profileOpen">
        <a (click)="logout()">ðŸšª Logout</a>
      </div>
    </div>
  </nav>
</header>

<!-- BEST SELLERS -->
<section class="best-sellers">
  <div class="create-btn-wrapper">
    <button class="create-btn" (click)="openDialog()">Create Product</button>
  
</div>

  

<div class="products">
  <div class="product" *ngFor="let item of filteredProducts; let i = index">
    
    <div class="image-slider">
      <img
        [src]="
          item.images && item.images.length > 0
            ? item.images[currentImageIndex[i] || 0]
            : item.image || 'assets/default.png'
        "
        [alt]="item.name"
      />
      <button
        *ngIf="item.images && item.images.length > 1"
        class="prev"
        (click)="prevImage(i, item.images.length)"
      >
        â€¹
      </button>
      <button
        *ngIf="item.images && item.images.length > 1"
        class="next"
        (click)="nextImage(i, item.images.length)"
      >
        â€º
      </button>
    </div>

    <div class="product-footer">
      <h3>{{ item.name }}</h3>
      <p>â‚¹{{ item.price }}</p>
        <p class="product-description">{{ item.description }}</p>
      <div class="action-buttons">
        <button class="update-btn" (click)="openUpdateDialog(item)">Update</button>
        <button class="delete-btn" (click)="deleteProduct(item)">Delete</button>
      </div>
    </div>
  </div>
</div>



</section>

<!-- CREATE PRODUCT DIALOG -->
<div class="dialog-overlay" *ngIf="showDialog">
  <div class="dialog-box">
    <h2>Create Product</h2>
    <form #productForm="ngForm">
      <input type="text" placeholder="Name" [(ngModel)]="newProduct.name" name="name" required />
      <input type="text" placeholder="Brand" [(ngModel)]="newProduct.brand" name="brand" required />
      <input type="text" placeholder="Category" [(ngModel)]="newProduct.category" name="category" required />
      <input type="number" placeholder="Price" [(ngModel)]="newProduct.price" name="price" required />

      <div class="upload-field">
        <label>Upload Product Images (Multiple):</label>
        <input type="file" (change)="onFilesSelected($event)" multiple />
      </div>

      <textarea placeholder="Description" [(ngModel)]="newProduct.description" name="description"></textarea>
      <input type="number" placeholder="Stock" [(ngModel)]="newProduct.stock" name="stock" />
    </form>
    <div class="dialog-actions">
      <button class="cancel-btn" (click)="closeDialog()">Cancel</button>
      <button class="save-btn" [disabled]="uploading" (click)="createProduct()">
        {{ uploading ? 'Uploading...' : 'Save' }}
      </button>
    </div>
  </div>
</div>

<!-- UPDATE PRODUCT DIALOG -->
<div class="dialog-overlay" *ngIf="showUpdateDialog">
  <div class="dialog-box">
    <h2>Update Product</h2>
    <form #updateForm="ngForm">
      <input type="text" placeholder="Name" [(ngModel)]="editProduct.name" name="name" required />
      <input type="text" placeholder="Brand" [(ngModel)]="editProduct.brand" name="brand" required />
      <input type="text" placeholder="Category" [(ngModel)]="editProduct.category" name="category" required />
      <input type="number" placeholder="Price" [(ngModel)]="editProduct.price" name="price" required />

      <div class="upload-field">
        <label>Upload New Product Images (Multiple):</label>
        <input type="file" (change)="onEditFilesSelected($event)" multiple />
      </div>

      <textarea placeholder="Description" [(ngModel)]="editProduct.description" name="description"></textarea>
      <input type="number" placeholder="Stock" [(ngModel)]="editProduct.stock" name="stock" />

      <div *ngIf="editProduct.images && editProduct.images.length > 0">
        <p>Current Images:</p>
        <div class="preview-images">
          <img *ngFor="let img of editProduct.images" [src]="img" alt="Current Image" />
        </div>
      </div>
    </form>
    <div class="dialog-actions">
      <button class="cancel-btn" (click)="closeUpdateDialog()">Cancel</button>
      <button class="save-btn" (click)="updateProductSave()">Update</button>
    </div>
  </div>
</div>

<router-outlet></router-outlet>
